const greenSingletrack = { "features": [{ "geometry": { "coordinates": [[-111.76318903756984, 41.770284496330625], [-111.76295300317653, 41.77010845654365], [-111.76183720422634, 41.77033250578785], [-111.76183055301188, 41.77031894009447], [-111.76179, 41.77033], [-111.76146, 41.7703], [-111.76098, 41.77018], [-111.76057, 41.77015], [-111.76042, 41.77016], [-111.76001, 41.77032], [-111.75976, 41.77045], [-111.75914, 41.77037], [-111.759, 41.77038], [-111.75864, 41.77048], [-111.75839, 41.77047], [-111.75793, 41.77055], [-111.75767, 41.77056], [-111.75719, 41.77062], [-111.75666, 41.77075], [-111.75608, 41.7708], [-111.75608, 41.7708], [-111.75519, 41.77074], [-111.75485, 41.77076], [-111.75485, 41.77076], [-111.75475429809151, 41.770748329035555], [-111.75473185884621, 41.770745592546234], [-111.75444, 41.77071], [-111.7543, 41.77072], [-111.75345, 41.77104], [-111.75331, 41.77112], [-111.75306, 41.77114], [-111.75293, 41.77118], [-111.75293, 41.77118], [-111.75247, 41.77131], [-111.75247, 41.77131], [-111.75217, 41.77138], [-111.75214678961429, 41.771375486869445], [-111.75215, 41.77137], [-111.75186, 41.77145], [-111.75158, 41.77146], [-111.75146, 41.77144], [-111.75128, 41.77147], [-111.7511, 41.77155], [-111.75099, 41.77157], [-111.75099357071112, 41.77156935274242], [-111.75071, 41.77172], [-111.75057, 41.77172], [-111.75033, 41.77187], [-111.75033, 41.77187], [-111.75033, 41.77187], [-111.7498, 41.77178], [-111.7498, 41.77178], [-111.74964, 41.77186], [-111.74955, 41.77188], [-111.74945, 41.77194], [-111.74937, 41.77177], [-111.74917, 41.77164], [-111.74912, 41.77165], [-111.7489, 41.77192], [-111.74883, 41.77195], [-111.74878, 41.77194], [-111.74874586618012, 41.77183077177634], [-111.74874586618012, 41.77183077177634], [-111.74873, 41.77178], [-111.74865, 41.77173], [-111.74863, 41.77169], [-111.74863, 41.77159], [-111.7486, 41.77153], [-111.74855, 41.77152], [-111.74847, 41.77161], [-111.74842, 41.77161], [-111.74782, 41.77149], [-111.74760997501048, 41.77146374687631], [-111.74760834252001, 41.77146354281571], [-111.74758, 41.77146], [-111.74734, 41.77149], [-111.74717, 41.77145], [-111.74716929174238, 41.77144965881318], [-111.74716929174238, 41.77144965881318], [-111.74688, 41.77131], [-111.74688, 41.77131], [-111.74676, 41.77127], [-111.74666, 41.77126], [-111.74648, 41.77131], [-111.74648, 41.77131], [-111.74634, 41.77135], [-111.74602, 41.77131], [-111.74602, 41.77131], [-111.74589, 41.77125], [-111.74537, 41.77122], [-111.74536954057065, 41.771220063809636], [-111.74537671268989, 41.77122038727069], [-111.74537, 41.77122], [-111.74501, 41.77127], [-111.74496, 41.77131], [-111.74496, 41.77131], [-111.74492, 41.77134], [-111.74472, 41.77132], [-111.74435, 41.77144], [-111.7443, 41.77149], [-111.74430000268174, 41.77148999929922], [-111.7443, 41.77149], [-111.74368955507482, 41.771578257097616], [-111.74369, 41.77158], [-111.74334, 41.77148], [-111.74318790435791, 41.77148], [-111.74318, 41.77148], [-111.74318, 41.77148], [-111.74307, 41.77154], [-111.74291, 41.77176], [-111.74284, 41.7718], [-111.74264, 41.77184], [-111.74255, 41.77189], [-111.74248481845619, 41.7719551778398], [-111.74248481845619, 41.7719551778398], [-111.74243, 41.77201], [-111.74243, 41.77201], [-111.74233, 41.77209], [-111.74233, 41.77209], [-111.74215, 41.7722], [-111.74199, 41.77224], [-111.74182, 41.77224], [-111.74137, 41.77236], [-111.74084, 41.77231], [-111.74066, 41.77235], [-111.74049, 41.77243], [-111.74033, 41.77245], [-111.74018, 41.77252], [-111.73991, 41.77257], [-111.73985, 41.77261], [-111.73966, 41.77261], [-111.73948, 41.77254], [-111.73939, 41.77256], [-111.73929, 41.77264], [-111.73915, 41.77266], [-111.73897462284636, 41.7726502568248], [-111.73898815510755, 41.77265100861719], [-111.73897, 41.77265], [-111.73887, 41.77269], [-111.73874, 41.77271], [-111.73824, 41.77267], [-111.73816, 41.77268], [-111.73792, 41.77285], [-111.73776, 41.77302], [-111.73762, 41.77324], [-111.73746, 41.77339], [-111.73716, 41.7736], [-111.73703, 41.77365], [-111.73666, 41.77375], [-111.73629, 41.7738], [-111.736, 41.77397], [-111.73572, 41.774], [-111.73535, 41.77429], [-111.73526, 41.77433], [-111.73516, 41.77448], [-111.73509, 41.77452], [-111.73475, 41.77459], [-111.73455, 41.7747], [-111.73443, 41.77488], [-111.7343, 41.77498], [-111.73418, 41.77518], [-111.73408, 41.77526], [-111.73393, 41.77535], [-111.73378, 41.7754], [-111.73355, 41.77542], [-111.73339, 41.77537], [-111.73339, 41.77537], [-111.73333, 41.77534], [-111.73333, 41.77534], [-111.73325, 41.77524], [-111.73317, 41.77522], [-111.73305, 41.77521], [-111.7330499981561, 41.77521000218173], [-111.7330499981561, 41.77521000218173], [-111.73283, 41.77529], [-111.73282272041868, 41.77529556673866], [-111.73281565563873, 41.77530096922759], [-111.73266, 41.77542], [-111.73257, 41.77555], [-111.73254, 41.77586], [-111.73246, 41.77595], [-111.73206, 41.776], [-111.7319, 41.77598], [-111.73169, 41.77593], [-111.73149, 41.77602], [-111.7312, 41.77621], [-111.73096, 41.77642], [-111.73096, 41.77642], [-111.73085, 41.77651], [-111.73067, 41.77682], [-111.73065, 41.7769], [-111.7307, 41.77703], [-111.73063, 41.77714], [-111.73044, 41.77726], [-111.73038, 41.77735], [-111.73034, 41.77756], [-111.7304, 41.77782], [-111.73066, 41.77837], [-111.73072, 41.77861], [-111.73062, 41.77884], [-111.73062, 41.77905], [-111.73055, 41.77917], [-111.73046, 41.77927], [-111.73035, 41.77934], [-111.73017, 41.77954], [-111.72995, 41.7797], [-111.72988, 41.77971], [-111.72985, 41.7798], [-111.72978, 41.77986], [-111.72955, 41.77994], [-111.72942, 41.78003], [-111.72928, 41.78008], [-111.72913, 41.78028], [-111.72902, 41.78035], [-111.72877, 41.78047], [-111.72829, 41.78064], [-111.7282, 41.7807], [-111.72811, 41.78084], [-111.72773, 41.78099], [-111.72772, 41.78114], [-111.72754, 41.78118], [-111.72738, 41.78128], [-111.72725606716807, 41.781460735379916], [-111.72725396257357, 41.78146380481843], [-111.72714, 41.78163], [-111.72706, 41.7817], [-111.72663, 41.78193], [-111.72656, 41.78203], [-111.72659, 41.78208], [-111.72667517463209, 41.78209806696575], [-111.72667517463209, 41.78209806696575], [-111.72692, 41.78215], [-111.72703, 41.78216], [-111.7272, 41.7821], [-111.72719, 41.78214], [-111.72713, 41.7822], [-111.727, 41.78226], [-111.72686, 41.78236], [-111.72660089759599, 41.78240798192667], [-111.7266068195781, 41.782406885264464], [-111.72659, 41.78241], [-111.72636, 41.7826], [-111.72616, 41.78282], [-111.72595, 41.78316], [-111.72557, 41.78364], [-111.72545, 41.78388], [-111.72542, 41.78403], [-111.72542, 41.78415], [-111.72548, 41.78436], [-111.72558, 41.78449], [-111.72585, 41.78469], [-111.72591, 41.78479], [-111.72606, 41.7852], [-111.72606, 41.7852], [-111.72606, 41.7852], [-111.72605, 41.78533], [-111.72586, 41.78576], [-111.72553, 41.78607], [-111.72552373228923, 41.7860862926296], [-111.72552373228923, 41.7860862926296], [-111.72548, 41.7862], [-111.72549, 41.78644], [-111.72549, 41.78644], [-111.72549, 41.78644], [-111.72547, 41.78653], [-111.72549, 41.7866], [-111.7255052829483, 41.78661020972985], [-111.72535, 41.7868], [-111.72528, 41.78683], [-111.72526, 41.78692], [-111.72535, 41.78698], [-111.72553, 41.78701], [-111.72559, 41.78706], [-111.72561, 41.78719], [-111.72572, 41.78735], [-111.72574, 41.78744], [-111.72562, 41.7877], [-111.72562, 41.7877], [-111.72558, 41.78785], [-111.72555, 41.78787], [-111.72547, 41.78787], [-111.7252271695003, 41.787965854144616], [-111.72523111302353, 41.787964297531694], [-111.72509, 41.78802], [-111.72472, 41.78855], [-111.72454, 41.78867], [-111.72419, 41.78904], [-111.72412, 41.78921], [-111.72389, 41.78944], [-111.72361, 41.78967], [-111.72325, 41.79007], [-111.72325, 41.79007], [-111.72325, 41.79007], [-111.72324, 41.79029], [-111.72324, 41.79029], [-111.72324, 41.79029], [-111.72323, 41.79035], [-111.72313, 41.79049], [-111.72303, 41.79052], [-111.72292, 41.7905], [-111.72281, 41.79055], [-111.72281, 41.79055], [-111.72276, 41.79056], [-111.72276, 41.79056], [-111.72268, 41.79056], [-111.72255, 41.79052], [-111.72208, 41.79076], [-111.72184, 41.79107], [-111.72165, 41.79157], [-111.72137, 41.79183], [-111.72123, 41.79203], [-111.72116, 41.79244], [-111.72107, 41.79253], [-111.72018, 41.79299], [-111.72004, 41.79312], [-111.71993, 41.79332], [-111.72001, 41.79344], [-111.72001, 41.79354], [-111.71991, 41.79383], [-111.7199100034886, 41.79382999644886], [-111.7199100034886, 41.79382999644886], [-111.7198659975613, 41.79380432295149]], "type": "LineString" }, "id": "b0a68fe5-9900-44fe-a87f-409fdfa974d1", "type": "Feature", "properties": { "stroke-opacity": 1, "pattern": "solid", "description": "", "stroke-width": 2, "title": "Green Singletrack", "fill": "#FF0000", "stroke": "#FF0000", "class": "Shape", "folderId": null } }], "type": "FeatureCollection" }
const greenSkiTrack = { "features": [{ "geometry": { "coordinates": [[-111.76886291504513, 41.76933259501863], [-111.76884145737301, 41.76939741055638], [-111.7688304173744, 41.76939043202088], [-111.76874, 41.76947], [-111.76874, 41.76947], [-111.76874, 41.76947], [-111.7686520255279, 41.769522784683254], [-111.7686520255279, 41.769522784683254], [-111.76854, 41.76959], [-111.76823, 41.76967], [-111.7677, 41.76986], [-111.76711, 41.76995], [-111.76695265963963, 41.77000006284194], [-111.76694911288845, 41.770001191361175], [-111.76689, 41.77002], [-111.76654, 41.77016], [-111.76637, 41.7702], [-111.76599, 41.7702], [-111.76566, 41.77015], [-111.7649, 41.77019], [-111.76453, 41.77029], [-111.76421512389085, 41.77031009847505], [-111.76418650478352, 41.77031192522658], [-111.76327004930106, 41.77037042238504], [-111.76327004930106, 41.77037042238504], [-111.76312, 41.77038], [-111.76292, 41.77044], [-111.76259, 41.77045], [-111.76206, 41.77041], [-111.76151, 41.77045], [-111.76131, 41.77053], [-111.7609, 41.77061], [-111.76044, 41.77066], [-111.76026, 41.77072], [-111.75983, 41.77073], [-111.75965, 41.7707], [-111.75961, 41.77067], [-111.75946, 41.77064], [-111.75937, 41.77067], [-111.75888, 41.7707], [-111.75862, 41.77067], [-111.7585, 41.77061], [-111.75818, 41.77063], [-111.75749, 41.77106], [-111.75718, 41.77115], [-111.75677, 41.77118], [-111.75634, 41.77117], [-111.75602, 41.7712], [-111.75512, 41.77107], [-111.75416, 41.7711], [-111.75395, 41.77113], [-111.75355, 41.77131], [-111.75355, 41.77131], [-111.75293, 41.77151], [-111.75293, 41.77151], [-111.7525, 41.77158], [-111.75183, 41.77192], [-111.75153, 41.772], [-111.75133, 41.772], [-111.75096186978158, 41.77194336458178], [-111.75096186978158, 41.77194336458178], [-111.75068, 41.7719], [-111.75050083268873, 41.77188464280189], [-111.75050083268873, 41.77188464280189], [-111.75033, 41.77187], [-111.75033, 41.77187], [-111.75033, 41.77187], [-111.7498, 41.77178], [-111.7498, 41.77178], [-111.7498, 41.77178], [-111.74958134528674, 41.77171752722478], [-111.74958134528674, 41.77171752722478], [-111.74952, 41.7717], [-111.74946, 41.77166], [-111.74946, 41.77166], [-111.7490821436487, 41.77142798294218], [-111.74908556357121, 41.771430083109806], [-111.74889, 41.77131], [-111.74889, 41.77131], [-111.74884, 41.77128], [-111.74861, 41.77123], [-111.74842, 41.77123], [-111.74779, 41.77131], [-111.74779, 41.77131], [-111.74716929174238, 41.77144965881318], [-111.74716929174238, 41.77144965881318], [-111.7467571987266, 41.77154238028652], [-111.7467571987266, 41.77154238028652], [-111.74659, 41.77158], [-111.74624, 41.77158], [-111.74569, 41.77149], [-111.74527, 41.77147], [-111.74465270169846, 41.77148272738925], [-111.74465765352195, 41.77148262529382], [-111.74430000268174, 41.77148999929922], [-111.74430000268174, 41.77148999929922], [-111.7443, 41.77149], [-111.74368955507482, 41.771578257097616], [-111.74368955507482, 41.771578257097616], [-111.74347, 41.77161], [-111.74263, 41.77194], [-111.74248481845619, 41.7719551778398], [-111.74248481845619, 41.7719551778398], [-111.74043, 41.77217], [-111.74007, 41.77224], [-111.73966, 41.77224], [-111.73909, 41.77236], [-111.73852, 41.7723], [-111.73808, 41.77235], [-111.73799, 41.77241], [-111.73786969787633, 41.77256568510122], [-111.73786969787633, 41.77256568510122], [-111.73765, 41.77285], [-111.73714748118964, 41.773156800957906], [-111.73714748118964, 41.773156800957906], [-111.7367, 41.77343], [-111.73598, 41.77355], [-111.73593108375512, 41.77357059631363], [-111.73593178189695, 41.7735703023813], [-111.7356, 41.77371], [-111.73518, 41.7738], [-111.73305, 41.77521], [-111.7330499981561, 41.77521000218173], [-111.7330499981561, 41.77521000218173], [-111.73278, 41.77584], [-111.7326, 41.77605], [-111.7318496722632, 41.776300109245604], [-111.73182951150112, 41.776306829505955], [-111.73182, 41.77631], [-111.73109, 41.77665], [-111.73096, 41.77676], [-111.73096, 41.77676], [-111.73093, 41.77678], [-111.73073, 41.77727], [-111.73077, 41.77748], [-111.73096, 41.77778], [-111.73096, 41.77778], [-111.73113, 41.77807], [-111.73124, 41.77832], [-111.73122, 41.77854], [-111.73115, 41.77874], [-111.73096, 41.77905], [-111.73096, 41.77905], [-111.73066, 41.77952], [-111.73035, 41.77987], [-111.73, 41.78013], [-111.72961, 41.78048], [-111.72823, 41.78107], [-111.7275, 41.78179], [-111.72667517463209, 41.78209806696575], [-111.72667517463209, 41.78209806696575], [-111.72667, 41.7821], [-111.72625, 41.78218], [-111.72578, 41.78256], [-111.72547, 41.78314], [-111.72513, 41.78345], [-111.72505, 41.78392], [-111.72468, 41.78425], [-111.72461, 41.78453], [-111.72486, 41.78486], [-111.72524, 41.78506], [-111.72533, 41.78526], [-111.72532, 41.78561], [-111.72552373228923, 41.7860862926296], [-111.72552373228923, 41.7860862926296], [-111.72606, 41.78734], [-111.72609, 41.78755], [-111.72604, 41.7877], [-111.72604, 41.7877], [-111.72595, 41.78797], [-111.72514, 41.78865], [-111.72492, 41.78929], [-111.72413, 41.79005], [-111.72341, 41.79054], [-111.72263, 41.79133], [-111.72219, 41.79152], [-111.72148, 41.79258], [-111.72078, 41.79297], [-111.7199100034886, 41.79382999644886], [-111.71991, 41.79383], [-111.71991983987421, 41.79383866846062], [-111.71993942261349, 41.793854125348126]], "type": "LineString" }, "id": "02d8c9d3-3409-4ddf-bf6e-92d6cf6fe2d6", "type": "Feature", "properties": { "stroke-opacity": 1, "pattern": "solid", "description": "", "stroke-width": 2, "title": "Green Ski", "fill": "#FF0000", "stroke": "#FF0000", "class": "Shape", "folderId": null } }], "type": "FeatureCollection" }
const beaverSkiTrack = { "features": [{ "geometry": { "coordinates": [[-111.53254105971364, 41.96954471046461], [-111.53260543273, 41.97061360527013], [-111.53269126341847, 41.97129960293461], [-111.53359248564747, 41.971873920878906], [-111.53509452269581, 41.971491042824724], [-111.5356309644988, 41.97091672142822], [-111.53593137190846, 41.97016690514492], [-111.53556659148244, 41.96984783170906], [-111.53490140364674, 41.96983187799531], [-111.5345151655486, 41.96940112621381], [-111.53393580840138, 41.96943303385307], [-111.53357102797536, 41.968124807538], [-111.53301312850026, 41.96774190694879], [-111.53266980574635, 41.96796526590552], [-111.53254105971364, 41.96952875667495], [-111.53273417876271, 41.9678057238735], [-111.53258397505788, 41.964917944029125], [-111.53279855177907, 41.96349793797814], [-111.53331353590993, 41.96429569808216], [-111.5332920782378, 41.96542850026724], [-111.5333993665984, 41.96665700944808], [-111.53359248564747, 41.968236486442976]], "type": "LineString" }, "id": "fd911db7-3a48-442c-95c5-2f605e4adef4", "type": "Feature", "properties": { "stroke-opacity": 1, "pattern": "solid", "description": "", "stroke-width": 2, "title": "Beaver", "fill": "#FF0000", "stroke": "#FF0000", "class": "Shape", "folderId": null } }], "type": "FeatureCollection" };
const smithfiedSkiTrack = { "features": [{ "geometry": { "coordinates": [[-111.75701825153794, 41.8695054480431], [-111.75695387852159, 41.86955338447845], [-111.75695654397065, 41.86955781867709], [-111.75695, 41.86956], [-111.75695, 41.86956], [-111.75627, 41.86979], [-111.75605, 41.86988], [-111.75576, 41.87004], [-111.75576, 41.87004], [-111.75572, 41.87017], [-111.75572, 41.87017], [-111.75573, 41.87034], [-111.75573, 41.87034], [-111.7557, 41.87044], [-111.75556, 41.87055], [-111.7554, 41.87061], [-111.75479, 41.87068], [-111.75453, 41.87069], [-111.75399, 41.87066], [-111.75328, 41.87076], [-111.75293, 41.87087], [-111.75293, 41.87087], [-111.75283, 41.87089], [-111.75252, 41.8709], [-111.751947586058, 41.871228434229025], [-111.75194844243279, 41.871227942923], [-111.75191, 41.87125], [-111.75161, 41.87133], [-111.75123, 41.8713], [-111.75094, 41.8713], [-111.75075, 41.87137], [-111.75045, 41.87156], [-111.75013, 41.87166], [-111.74965, 41.87175], [-111.74927, 41.87191], [-111.74888, 41.87202], [-111.74851, 41.87217], [-111.74801, 41.87245], [-111.74758, 41.87255], [-111.74736, 41.87253], [-111.74719, 41.87247], [-111.74693, 41.87227], [-111.74663, 41.87178], [-111.74647, 41.87164], [-111.74624, 41.87155], [-111.7457, 41.87141], [-111.74553, 41.87141], [-111.74532, 41.87147], [-111.74515, 41.87158], [-111.74491, 41.87182], [-111.74472, 41.87204], [-111.74462, 41.87222], [-111.74448, 41.87234], [-111.74411, 41.87257], [-111.7438, 41.8727], [-111.74291, 41.873], [-111.7425, 41.87308], [-111.74192, 41.87308], [-111.74169, 41.87313], [-111.74134, 41.87341], [-111.74066, 41.87373], [-111.74061, 41.87377], [-111.74057, 41.87383], [-111.7406, 41.8741], [-111.74056, 41.87418], [-111.73996, 41.87462], [-111.73969, 41.87489], [-111.73948, 41.87495], [-111.73895, 41.875], [-111.73875, 41.87507], [-111.73868, 41.87515], [-111.73865, 41.87533], [-111.73857, 41.87548], [-111.73819, 41.87588], [-111.73808, 41.87605], [-111.738, 41.87623], [-111.73791, 41.87661], [-111.73777, 41.87693], [-111.73762, 41.87707], [-111.73732, 41.87721], [-111.7368, 41.87758], [-111.73667, 41.87762], [-111.73653, 41.87762], [-111.73594, 41.87761], [-111.73488, 41.87772], [-111.73424, 41.87786], [-111.7333, 41.87792], [-111.73201, 41.87813], [-111.7318, 41.87827], [-111.73141, 41.87867], [-111.73096, 41.87894], [-111.73096, 41.87894], [-111.73044, 41.87931], [-111.73017, 41.87946], [-111.72938, 41.87958], [-111.72875, 41.87955], [-111.72836, 41.87966], [-111.72791, 41.87984], [-111.72764454709574, 41.87986895849865], [-111.72764906155257, 41.87986846601945], [-111.72736, 41.8799], [-111.72713, 41.87998], [-111.72663, 41.88031], [-111.72642, 41.88054], [-111.72627, 41.88089], [-111.72608, 41.88147], [-111.72602, 41.8816], [-111.72584, 41.88183], [-111.72571, 41.88192], [-111.72542, 41.88201], [-111.72505, 41.88225], [-111.72489, 41.88231], [-111.72456, 41.88232], [-111.72436986419002, 41.88231161165544], [-111.72436986419002, 41.88231161165544], [-111.72388, 41.88229], [-111.72347, 41.88219], [-111.72267, 41.88187], [-111.7223, 41.88176], [-111.72208, 41.88173], [-111.72186, 41.88173], [-111.72119, 41.88186], [-111.72093, 41.88196], [-111.72086715007673, 41.88199351995909], [-111.72085134518113, 41.88197545472812]], "type": "LineString" }, "id": "cbaabf8f-c9c6-4d1c-8088-0cc6ebc8e292", "type": "Feature", "properties": { "stroke-opacity": 1, "pattern": "solid", "description": "", "stroke-width": 2, "title": "Smithfield", "fill": "#FF0000", "stroke": "#FF0000", "class": "Shape", "folderId": null } }], "type": "FeatureCollection" };

const demoInfo = {
    minDate: new Date("2100-01-01T00:00:00Z"),
    maxDate: new Date("2000-01-01T00:00:00Z"),
    stepHours: 12,
    demoCurrentTime: null,
    runTimer: false,
};

const globalStrokeWeight = 5;

const globalMapInformation = {
    "Green Canyon - single track": {
        jsonFile: greenSingletrack,
        lineParams: {
            style: "dotted",
            weight: globalStrokeWeight
        },
        reports: [],
        mapLine: null,
    },
    "Green Canyon - ski trail": {
        jsonFile: greenSkiTrack,
        lineParams: {
            weight: globalStrokeWeight
        },
        reports: [],
        mapLine: null,
    },
    "Beaver Bottoms": {
        jsonFile: beaverSkiTrack,
        lineParams: {
            weight: globalStrokeWeight
        },
        reports: [],
        mapLine: null,
    },
    "Smithfield Canyon": {
        jsonFile: smithfiedSkiTrack,
        lineParams: {
            weight: globalStrokeWeight
        },
        reports: [],
        mapLine: null,
    },
};


// Global variable
// let myMapManager = null;

function initMap() {
    // Initialize MapManager, modal, and modalmapmanager classes
    // demoMode();
    myMapManager = new MapManager('map', { lat: 41.850, lng: -111.697 }, 12);


    /*
        globalMapInformation.forEach((trail) => {
        addTrailFromGeoJSON(trail.jsonFile, myMapManager.getMap(), trail.lineParams);

    });
    */

    for (const [name, trail] of Object.entries(globalMapInformation)) {
        console.log("Drawing:", name);
        trail.mapLine = addTrailFromGeoJSON(trail.jsonFile, myMapManager.getMap(), trail.lineParams);
    }



    // const nuAPIAddress = "https://script.google.com/a/macros/nordicunited.org/s/AKfycbzTAd8UUFP_0DFH-wRuHd0AkJ4WJ3EliR09LqgYxA/dev?kind=json";

    const nuAPIAddress = "https://script.google.com/macros/s/AKfycbylOM41twbS0JzthyqQWnRkX0rhlaK3o5IwlvT2ysvgG_h9hlSDx9RNP0_QfRyuPpg/exec?kind=json";
    // fetchTrailData(nuAPIAddress, processReceivedTrailConditions);
    fetchTrailData(nuAPIAddress, runDemo);


}

function runDemo() {

    function formatDate(date) {
        const mm = String(date.getMonth() + 1).padStart(2, "0"); // months 0–11
        const dd = String(date.getDate()).padStart(2, "0");
        const yy = String(date.getFullYear()).slice(-2);

        const hh = String(date.getHours()).padStart(2, "0");
        const min = String(date.getMinutes()).padStart(2, "0");

        return `${mm}/${dd}/${yy} ${hh}:${min}`;
    }

    function sliderUpdate(slider) {
        const fraction = slider.value / slider.max;
        const newTime = new Date(
            demoInfo.minDate.getTime() +
            fraction * (demoInfo.maxDate.getTime() - demoInfo.minDate.getTime())
        );

        // If the new time is less than the old time we need to reset the array
        if (newTime < demoInfo.demoCurrentTime) {
            for (const [name, trail] of Object.entries(globalMapInformation)) {
                demoTrails[name] = {
                    reports: trail.reports.map(r => ({ ...r }))
                };
            }
        }

        demoInfo.demoCurrentTime = newTime;

        // Live label update
        // currentTimeLabel.textContent = formatDate(newTime);

        // (optional) update map immediately while dragging
        processReceivedTrailConditions(globalMapInformation, newTime);
        sidebarDiv.innerHTML = `<h3>${formatDate(newTime)}</h3>`;

    }

    console.log("Running Demo");
    console.log(demoInfo);
    demoInfo.runTimer = true;
    // const demoTrails = JSON.parse(JSON.stringify(globalMapInformation));

    const demoTrails = {};
    for (const [name, trail] of Object.entries(globalMapInformation)) {
        demoTrails[name] = {
            reports: trail.reports.map(r => ({ ...r }))
        };
    }

    console.log(demoTrails);

    // Create timer display
    const sidebarDiv = document.createElement("div");
    sidebarDiv.id = "sidebar-timer";
    const startStopBtn = document.createElement("button");
    startStopBtn.textContent = demoInfo.runTimer == true ? "Stop" : "Start";
    startStopBtn.onclick = function () {
        demoInfo.runTimer = !demoInfo.runTimer;
        startStopBtn.textContent = demoInfo.runTimer == true ? "Stop" : "Start";

    };




    document.getElementById("sidebar").appendChild(startStopBtn);


    document.getElementById("sidebar").appendChild(buildDynamicSlider(
        "time-slider",
        formatDate(demoInfo.minDate),
        formatDate(demoInfo.maxDate),
        sliderUpdate));




    // sidebar.appendChild(sliderContainer);


    document.getElementById("sidebar").appendChild(sidebarDiv);

    demoInfo.demoCurrentTime = new Date(demoInfo.minDate);

    const realInterval = 250; // 250ms per tick
    const intervalRatio = realInterval / 1000;

    const msPerStep = demoInfo.stepHours * intervalRatio * 60 * 60 * 1000; // hours → ms


    const timer = setInterval(() => {

        // console.log("Timer!");
        // Stop if we've gone past maxDate
        if (demoInfo.demoCurrentTime > demoInfo.maxDate) {
            clearInterval(timer);
            console.log("Demo finished");
            return;
        }

        if (demoInfo.runTimer) {

            const myTable = new TableDomObject();
            myTable.addRow();
            myTable.addRowItem("Trail", true);
            myTable.addRowItem("Previous", true);
            myTable.addRowItem("Next", true);




            // For each trail, prune reports newer than currentTime
            for (const trailName in demoTrails) {
                const trail = demoTrails[trailName];
                myTable.addRow();
                myTable.addRowItem(trailName);
                myTable.addRowItem(formatDate(new Date(trail.reports.at(-1).reportTime)));
                myTable.addRowItem(formatDate(new Date(trail.reports.at(-2).reportTime)));


                // Keep reports that are strictly older than the reference time
                while (
                    trail.reports.length > 1 &&
                    new Date(trail.reports[trail.reports.length - 1].reportTime) < demoInfo.demoCurrentTime
                ) {
                    // console.log("Popping");
                    if (new Date(trail.reports[trail.reports.length - 2].reportTime) > demoInfo.demoCurrentTime) {
                        break;
                    }
                    //console.log("Pop 2");
                    // Removing this print line causes the whole script to hang and crash the browser sometimes :panic:
                    console.log(trailName + ": " + JSON.stringify(trail.reports.pop())); // remove last (newest still too new)
                }
            }

            // Call your callback with the current state + time
            processReceivedTrailConditions(demoTrails, demoInfo.demoCurrentTime);
            // Advance reference time
            demoInfo.demoCurrentTime = new Date(demoInfo.demoCurrentTime.getTime() + msPerStep);

            const total = demoInfo.maxDate.getTime() - demoInfo.minDate.getTime();
            const current = demoInfo.demoCurrentTime.getTime() - demoInfo.minDate.getTime();
            const fraction = current / total;

            const sliderObject = document.getElementById("time-slider");

            // Map time → slider value
            sliderObject.value = Math.round(fraction * sliderObject.max);



            const sidebarDiv = document.getElementById("sidebar-timer");
            sidebarDiv.innerHTML = "<h3>" + formatDate(demoInfo.demoCurrentTime) + "</h3>";
            sidebarDiv.innerHTML += myTable.getTable().outerHTML;

        }


    }, realInterval);
}


// Function to load from API
function fetchTrailData(url, callback) {
    fetch(url)
        .then(response => {
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return response.json();
        })
        .then(data => {

            // assign to global
            let trailData = data;
            // console.log("Trail data loaded:", trailData);

            // For every report in the collection of reports, assign them to the right trail object
            trailData.forEach(report => {
                const trail = globalMapInformation[report.trail];
                if (trail && report.isGroomer == "Groomer") {
                    trail.reports.push(report);
                    updateDemoInfo(new Date(report.reportTime));
                }
            });

            // Sort the reports by the report date for each trail object
            for (const trail of Object.values(globalMapInformation)) {
                trail.reports.sort((a, b) => new Date(b.reportTime) - new Date(a.reportTime));
            }

            console.log(globalMapInformation);

            // fire the callback if provided
            if (typeof callback === "function") {
                callback();
            }
        })
        .catch(err => {
            console.error("Error fetching trail data:", err);
        });
}

function updateDemoInfo(newDate) {

    // console.log(newDate);

    demoInfo.minDate = newDate < demoInfo.minDate ? newDate : demoInfo.minDate;
    demoInfo.maxDate = newDate > demoInfo.maxDate ? newDate : demoInfo.maxDate;
    // console.log(demoInfo);
}

function processReceivedTrailConditions(trails = globalMapInformation, referenceDate = new Date()) {


    for (const [name, trail] of Object.entries(trails)) {
        // console.log("Drawing:", name);
        //console.log("Report Time: ", trail.reports.at(-1).reportTime instanceof Date);
        // console.log("Current Time: ", referenceDate instanceof Date);

        globalMapInformation[name].mapLine.setOptions(
            {
                strokeColor: rgbToHex(...getTrailColor(trail.reports.at(-1).reportTime, referenceDate))
            }
        )
    }
}

function getTrailColor(reportDate, referenceDate = new Date()) {
    // Make sure we have Date objects
    const report = new Date(reportDate);
    const ref = new Date(referenceDate);

    // Delta in days
    const deltaMs = ref - report;
    const deltaDays = deltaMs / (1000 * 60 * 60 * 24);

    // console.log(deltaDays);

    // Normalize: clamp to 0..1
    let t = deltaDays < 0 ? 1 : Math.min(deltaDays / 5, 1);

    // Two-segment cyan→blue→purple ramp
    const cyan = [0, 255, 255];
    const blue = [0, 0, 255];
    const purple = [128, 0, 128];

    let start, end, localT;
    if (t < 0.5) {
        start = cyan;
        end = blue;
        localT = t / 0.5;
    } else {
        start = blue;
        end = purple;
        localT = (t - 0.5) / 0.5;
    }

    const r = Math.round(start[0] + (end[0] - start[0]) * localT);
    const g = Math.round(start[1] + (end[1] - start[1]) * localT);
    const b = Math.round(start[2] + (end[2] - start[2]) * localT);

    return [r, g, b]
}


function addTrailFromGeoJSON(geoJSON, map, options = {}) {
    const {
        color = "#00FF80",
        weight = 3,          // line thickness
        style = "solid"      // "solid", "dashed", "dotted", "arrows"
    } = options;

    // Grab the first (and only) LineString
    const coords = geoJSON.features[0].geometry.coordinates;

    // Convert [lon, lat] → {lat, lng}
    const path = coords.map(c => ({ lat: c[1], lng: c[0] }));

    // Base polyline config
    const polyConfig = {
        path,
        geodesic: true,
        strokeColor: color,
        strokeOpacity: 1.0,
        strokeWeight: weight,
        map
    };

    // Add style overrides
    switch (style) {
        case "dashed":
            polyConfig.icons = [{
                icon: { path: "M 0,-1 0,1", strokeOpacity: 1, scale: weight },
                offset: "0",
                repeat: "20px"
            }];
            polyConfig.strokeOpacity = 0; // hide solid stroke
            break;

        case "dotted":
            polyConfig.icons = [{
                icon: { path: google.maps.SymbolPath.CIRCLE, scale: weight, fillOpacity: 1 },
                offset: "0",
                repeat: "10px"
            }];
            polyConfig.strokeOpacity = 0;
            break;

        case "arrows":
            polyConfig.icons = [{
                icon: { path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW, scale: weight + 2 },
                offset: "50%" // middle of line
            }];
            break;

        // "solid" or anything else = default stroke
    }

    const polyline = new google.maps.Polyline(polyConfig);

    // Click listener
    polyline.addListener("click", (event) => {
        console.log("Polyline clicked at:", event.latLng.toString());

        const info = new google.maps.InfoWindow({
            content: "You clicked the trail!",
            position: event.latLng
        });
        info.open(map);
    });

    return polyline;
}




async function addTrailFromGeoJSON2(fileName, map) {
    try {
        const response = await fetch(fileName);
        if (!response.ok) throw new Error("Failed to load " + fileName);

        const geojson = await response.json();

        // Grab the first (and only) LineString
        const coords = geojson.features[0].geometry.coordinates;

        // Convert [lon, lat] → {lat, lng}
        const path = coords.map(c => ({ lat: c[1], lng: c[0] }));

        // Create polyline
        const polyline = new google.maps.Polyline({
            path,
            geodesic: true,
            strokeColor: "#00AAFF",
            strokeOpacity: 1.0,
            strokeWeight: 3
        });

        polyline.setMap(map);
        return polyline;

    } catch (err) {
        console.error("Error loading trail:", err);
    }
}



function demoMode() {
    const container = document.getElementById("container");
    container.style.display = "flex";
    container.style.height = "100%";
    container.style.width = "100%";

    const sidebar = document.getElementById("sidebar");
    sidebar.style.flex = "2"; // 20%
    sidebar.style.height = "100%";
    sidebar.style.overflowY = "auto";
    sidebar.style.borderRight = "1px solid #ccc";
    sidebar.style.padding = "10px";
    sidebar.style.boxSizing = "border-box";

    const mapDiv = document.getElementById("map");
    mapDiv.style.flex = "8"; // 80%
    mapDiv.style.height = "100%";
}