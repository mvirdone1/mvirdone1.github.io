<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Antenna Coverage KML Generator (3D wedge)</title>
  <link rel="stylesheet" href="kml-lib/kml-style.css" />
<script defer src="kml-lib/kml-script.js"></script>
</head>
<body>
  <header>
    <div class="container" style="grid-template-columns:1fr;">
      <h1>3D Antenna Coverage → KML</h1>
      <p>Generate a KML of a 3D wedge from an antenna location, azimuth/elevation pointing, and beamwidths. Ideal for loading into Google Earth Pro.</p>
    </div>
  </header>
  <div class="container">
    <section class="card">
      <form id="form">
        <fieldset>
          <legend>Site / Antenna</legend>
          <div class="row3">
            <div>
              <label for="lat">Latitude (°)</label>
              <input id="lat" type="number" step="any" value="41.737" required />
            </div>
            <div>
              <label for="lon">Longitude (°)</label>
              <input id="lon" type="number" step="any" value="-111.833" required />
            </div>
            <div>
              <label for="alt">Antenna Altitude (m, AMSL)</label>
              <input id="alt" type="number" step="any" value="1400" required />
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Pointing & Beam</legend>
          <div class="row3">
            <div>
              <label for="az">Azimuth Center (° from North, CW)</label>
              <input id="az" type="number" step="any" value="180" />
            </div>
            <div>
              <label for="azBw">Azimuth Beamwidth (°)</label>
              <input id="azBw" type="number" step="any" value="90" />
            </div>
            <div>
              <label for="el">Elevation Center (° from horizon, +up)</label>
              <input id="el" type="number" step="any" value="17" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="elBw">Elevation Beamwidth (°)</label>
              <input id="elBw" type="number" step="any" value="30" />
            </div>
            <div>
              <label for="tiltNote">&nbsp;</label>
              <div class="small">Tip: Negative elevation looks downward; positive looks above horizon.</div>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Range & Meshing</legend>


          
          <div class="row">
            <div id="rangeRings">
              <h3>Range Rings</h3>
              <div>
                <label>Ring 1 Max Range (km)</label>
                <input type="number" id="rMax1" value="2" min="0.1" step="0.1">
              </div>
              <div>
                <label>Ring 2 Max Range (km)</label>
                <input type="number" id="rMax2" value="4" min="0.1" step="0.1">
              </div>
              <div>
                <label>Ring 3 Max Range (km)</label>
                <input type="number" id="rMax3" value="6" min="0.1" step="0.1">
              </div>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="azSteps">Azimuth Segments</label>
              <input id="azSteps" type="number" value="12" />
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Output</legend>
          <div class="row">
            <div>
              <label for="name">Name</label>
              <input id="name" type="text" value="Antenna 3D Wedge" />
            </div>
            <div>
              <label for="styleColor">Color (KML aabbggrr)</label>
              <input id="styleColor" type="text" value="7dff8000" />
            </div>
          </div>
        </fieldset>

        <div class="actions">
          <button class="primary" type="button" id="gen">Generate KML</button>
          <button class="secondary" type="button" id="download" disabled>Download .kml</button>
        </div>
      </form>
      <p class="small">KML note: Google Earth cannot render true volumes; this exporter builds many small <code>&lt;Polygon&gt;</code> faces (caps + sides) with 3D vertices to visually approximate a volume.</p>
      <details>
        <summary>Advanced: math & assumptions</summary>
        <ul class="small">
          <li>Earth model: WGS‑84. Local ENU frame at antenna, convert to ECEF, then to geodetic (lat, lon, alt).</li>
          <li>Azimuth is 0° = North, increases clockwise. Elevation is +° above the horizon, −° below.</li>
          <li>Range is straight‑line slant range through air, not ground distance. Altitude = antenna_alt + r·sin(el).</li>
          <li>Min range face is skipped if set to 0 km. Increase segments for smoother arcs.</li>
        </ul>
      </details>
    </section>

    <section class="card">
      <div class="grid2">
        <div>
          <h3 style="margin-top:0">Preview (first 25 kB)</h3>
          <pre id="out" class="out preview">Nothing yet. Set parameters and click “Generate KML”.</pre>
        </div>
        <div>
          <h3 style="margin-top:0">How to use</h3>
          <ol class="small">
            <li>Enter antenna location and pointing/beam parameters.</li>
            <li>Click <span class="kbd">Generate KML</span>. Inspect the preview.</li>
            <li>Click <span class="kbd">Download .kml</span>, then open the file in Google Earth Pro or Web.</li>
            <li>Toggle transparency by editing the color (format <code>aabbggrr</code>), e.g., <code>40ff0000</code> = 25% opaque red.</li>
          </ol>
          <p class="small">Keyboard: After generating, press <span class="kbd">Ctrl/Cmd+A</span> then <span class="kbd">Ctrl/Cmd+C</span> to copy KML if you prefer.</p>
        </div>
      </div>
    </section>
  </div>


</body>
</html>
